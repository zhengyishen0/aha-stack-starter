---
import Layout from '../../layouts/Layout.astro';
import Card from '../../components/pine/Card.astro';
import Button from '../../components/pine/Button.astro';
import Badge from '../../components/pine/Badge.astro';
import DatePicker from '../../components/pine/DatePicker.astro';
---

<Layout title="DatePicker Component Test">
  <main class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold mb-4">DatePicker Component Test</h1>
      <div class="flex justify-center gap-2 mb-6">
        <Button href="/test" variant="outline" color="neutral">← Back to Test Suite</Button>
        <Button href="/test/all" variant="ghost" color="neutral">View All</Button>
      </div>
    </div>

    <!-- Basic Date Selection Test -->
    <Card class="mb-8">
      <div class="p-6">
        <h2 class="text-2xl font-bold mb-4">Basic Date Selection</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h3 class="text-lg font-semibold mb-4">Standard Date Picker</h3>
            <div class="space-y-4">
              <DatePicker 
                name="basic-date"
                placeholder="Select a date"
                value=""
              />
              
              <DatePicker 
                name="pre-selected"
                placeholder="Pre-selected date"
                value="2024-03-15"
              />
              
              <DatePicker 
                name="today-date"
                placeholder="Today's date"
                value={new Date().toISOString().split('T')[0]}
              />
            </div>
          </div>
          
          <div>
            <h3 class="text-lg font-semibold mb-4">With Custom Placeholders</h3>
            <div class="space-y-4">
              <DatePicker 
                name="birth-date"
                placeholder="Enter your birthday"
                value=""
              />
              
              <DatePicker 
                name="event-date"
                placeholder="Event date"
                value=""
              />
              
              <DatePicker 
                name="deadline"
                placeholder="Project deadline"
                value=""
              />
            </div>
          </div>
        </div>
      </div>
    </Card>

    <!-- Date Format Variants Test -->
    <Card class="mb-8">
      <div class="p-6">
        <h2 class="text-2xl font-bold mb-4">Date Format Variants</h2>
        <div class="space-y-6">
          <div>
            <h3 class="text-lg font-semibold mb-3">ISO Format (Y-m-d)</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <DatePicker 
                name="iso-format"
                placeholder="YYYY-MM-DD format"
                format="Y-m-d"
                value="2024-06-15"
              />
              <div class="flex items-center text-sm text-gray-600">
                <strong>Format:</strong> Y-m-d → 2024-06-15
              </div>
            </div>
          </div>
          
          <div>
            <h3 class="text-lg font-semibold mb-3">US Format (M j, Y)</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <DatePicker 
                name="us-format"
                placeholder="US date format"
                format="M j, Y"
                value="2024-06-15"
              />
              <div class="flex items-center text-sm text-gray-600">
                <strong>Format:</strong> M j, Y → Jun 15, 2024
              </div>
            </div>
          </div>
          
          <div>
            <h3 class="text-lg font-semibold mb-3">Numeric Format (m/d/Y)</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <DatePicker 
                name="numeric-format"
                placeholder="MM/DD/YYYY format"
                format="m/d/Y"
                value="2024-06-15"
              />
              <div class="flex items-center text-sm text-gray-600">
                <strong>Format:</strong> m/d/Y → 06/15/2024
              </div>
            </div>
          </div>
          
          <div>
            <h3 class="text-lg font-semibold mb-3">Full Format (j F Y)</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <DatePicker 
                name="full-format"
                placeholder="Full date format"
                format="j F Y"
                value="2024-06-15"
              />
              <div class="flex items-center text-sm text-gray-600">
                <strong>Format:</strong> j F Y → 15 June 2024
              </div>
            </div>
          </div>
        </div>
      </div>
    </Card>

    <!-- States Test -->
    <Card class="mb-8">
      <div class="p-6">
        <h2 class="text-2xl font-bold mb-4">DatePicker States</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h3 class="text-lg font-semibold mb-4">Standard States</h3>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Normal State</label>
                <DatePicker 
                  name="normal-state"
                  placeholder="Select a date"
                  value=""
                />
                <p class="text-sm text-gray-500 mt-1">Standard interactive date picker</p>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">With Pre-selected Value</label>
                <DatePicker 
                  name="preset-state"
                  placeholder="Date is pre-selected"
                  value="2024-12-25"
                  format="M j, Y"
                />
                <p class="text-sm text-gray-500 mt-1">Date picker with initial value</p>
              </div>
            </div>
          </div>
          
          <div>
            <h3 class="text-lg font-semibold mb-4">Disabled States</h3>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Disabled DatePicker</label>
                <DatePicker 
                  name="disabled-state"
                  placeholder="Cannot be changed"
                  value="2024-01-01"
                  disabled={true}
                />
                <p class="text-sm text-gray-500 mt-1">DatePicker is completely disabled</p>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Read-only DatePicker</label>
                <DatePicker 
                  name="readonly-state"
                  placeholder="Read-only value"
                  value="2024-07-04"
                  readonly={true}
                  format="j F Y"
                />
                <p class="text-sm text-gray-500 mt-1">DatePicker value cannot be modified</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </Card>

    <!-- Custom Styling Examples -->
    <Card class="mb-8">
      <div class="p-6">
        <h2 class="text-2xl font-bold mb-4">Custom Styling Examples</h2>
        <div class="space-y-6">
          <!-- Custom Input Classes -->
          <div>
            <h3 class="text-lg font-semibold mb-3">Custom Input Styling</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Rounded Input</label>
                <DatePicker 
                  name="custom-rounded"
                  placeholder="Rounded corners"
                  inputClass="rounded-full"
                />
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Colored Border</label>
                <DatePicker 
                  name="custom-border"
                  placeholder="Purple theme"
                  inputClass="border-purple-300 focus:border-purple-500 focus:ring-purple-500"
                />
              </div>
            </div>
          </div>
          
          <!-- Custom Calendar Styling -->
          <div>
            <h3 class="text-lg font-semibold mb-3">Custom Calendar Styling</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Large Calendar</label>
                <DatePicker 
                  name="large-calendar"
                  placeholder="Large calendar popup"
                  calendarClass="w-80 p-6"
                />
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Styled Calendar</label>
                <DatePicker 
                  name="styled-calendar"
                  placeholder="Custom calendar style"
                  calendarClass="bg-blue-50 border-blue-200"
                />
              </div>
            </div>
          </div>
          
          <!-- Container Styling -->
          <div>
            <h3 class="text-lg font-semibold mb-3">Container Styling</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Background Container</label>
                <DatePicker 
                  name="bg-container"
                  placeholder="Highlighted container"
                  class="bg-green-50 p-4 rounded-lg"
                />
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Bordered Container</label>
                <DatePicker 
                  name="border-container"
                  placeholder="Dashed border"
                  class="border-2 border-dashed border-gray-300 p-4 rounded-lg"
                />
              </div>
            </div>
          </div>
        </div>
      </div>
    </Card>

    <!-- Interactive Form Example -->
    <Card class="mb-8">
      <div class="p-6">
        <h2 class="text-2xl font-bold mb-4">Interactive Form Example</h2>
        <form x-data="{ 
          formData: {
            startDate: '',
            endDate: '',
            birthDate: '',
            eventDate: '',
            appointmentDate: ''
          },
          
          errors: {},
          
          validateDate(field, value) {
            this.errors[field] = '';
            
            if (!value) {
              this.errors[field] = 'This field is required';
              return;
            }
            
            const selectedDate = new Date(value);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            switch(field) {
              case 'startDate':
                if (selectedDate < today) {
                  this.errors[field] = 'Start date cannot be in the past';
                }
                break;
              case 'endDate':
                if (this.formData.startDate && selectedDate <= new Date(this.formData.startDate)) {
                  this.errors[field] = 'End date must be after start date';
                }
                break;
              case 'birthDate':
                const maxAge = new Date();
                maxAge.setFullYear(maxAge.getFullYear() - 120);
                const minAge = new Date();
                minAge.setFullYear(minAge.getFullYear() - 13);
                
                if (selectedDate < maxAge) {
                  this.errors[field] = 'Birth date seems too far in the past';
                } else if (selectedDate > minAge) {
                  this.errors[field] = 'You must be at least 13 years old';
                }
                break;
              case 'appointmentDate':
                const maxFuture = new Date();
                maxFuture.setFullYear(maxFuture.getFullYear() + 1);
                
                if (selectedDate < today) {
                  this.errors[field] = 'Appointment cannot be in the past';
                } else if (selectedDate > maxFuture) {
                  this.errors[field] = 'Appointments can only be scheduled up to 1 year in advance';
                }
                break;
            }
          },
          
          validateDateRange() {
            if (this.formData.startDate && this.formData.endDate) {
              this.validateDate('endDate', this.formData.endDate);
            }
          },
          
          submitForm() {
            // Validate all fields
            Object.keys(this.formData).forEach(field => {
              this.validateDate(field, this.formData[field]);
            });
            
            this.validateDateRange();
            
            const hasErrors = Object.values(this.errors).some(error => error);
            
            if (!hasErrors) {
              alert('Form submitted successfully!\\n\\n' + JSON.stringify(this.formData, null, 2));
            } else {
              alert('Please fix the errors in the form before submitting.');
            }
          }
        }" @submit.prevent="submitForm()">
          <div class="space-y-6">
            <!-- Date Range Selection -->
            <div>
              <h3 class="text-lg font-semibold mb-4">Event Date Range</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Start Date *</label>
                  <DatePicker 
                    name="start-date"
                    placeholder="Select start date"
                    format="M j, Y"
                    x-model="formData.startDate"
                    @change="validateDate('startDate', $event.target.value); validateDateRange();"
                  />
                  <p x-show="errors.startDate" class="text-red-500 text-sm mt-1" x-text="errors.startDate"></p>
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">End Date *</label>
                  <DatePicker 
                    name="end-date"
                    placeholder="Select end date"
                    format="M j, Y"
                    x-model="formData.endDate"
                    @change="validateDate('endDate', $event.target.value);"
                  />
                  <p x-show="errors.endDate" class="text-red-500 text-sm mt-1" x-text="errors.endDate"></p>
                </div>
              </div>
            </div>
            
            <!-- Personal Information -->
            <div>
              <h3 class="text-lg font-semibold mb-4">Personal Information</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Birth Date *</label>
                  <DatePicker 
                    name="birth-date"
                    placeholder="Your birth date"
                    format="j F Y"
                    x-model="formData.birthDate"
                    @change="validateDate('birthDate', $event.target.value);"
                  />
                  <p class="text-sm text-gray-500 mt-1">Must be between 13 and 120 years old</p>
                  <p x-show="errors.birthDate" class="text-red-500 text-sm mt-1" x-text="errors.birthDate"></p>
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Event Date</label>
                  <DatePicker 
                    name="event-date"
                    placeholder="Special event date"
                    format="m/d/Y"
                    x-model="formData.eventDate"
                  />
                  <p class="text-sm text-gray-500 mt-1">Optional event or anniversary date</p>
                </div>
              </div>
            </div>
            
            <!-- Appointment Scheduling -->
            <div>
              <h3 class="text-lg font-semibold mb-4">Appointment Scheduling</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Appointment Date *</label>
                  <DatePicker 
                    name="appointment-date"
                    placeholder="Schedule appointment"
                    format="Y-m-d"
                    x-model="formData.appointmentDate"
                    @change="validateDate('appointmentDate', $event.target.value);"
                  />
                  <p class="text-sm text-gray-500 mt-1">Cannot be in the past, max 1 year ahead</p>
                  <p x-show="errors.appointmentDate" class="text-red-500 text-sm mt-1" x-text="errors.appointmentDate"></p>
                </div>
              </div>
            </div>
            
            <!-- Form Actions -->
            <div class="flex gap-4 pt-6 border-t">
              <Button type="submit" variant="solid" color="blue">
                Submit Form
              </Button>
              <Button type="button" variant="outline" color="neutral" @click="formData = {}; errors = {};">
                Clear Form
              </Button>
            </div>
            
            <!-- Form Data Preview -->
            <div class="mt-6 p-4 bg-gray-50 rounded-lg">
              <h4 class="font-semibold mb-2">Form Data Preview:</h4>
              <pre class="text-sm text-gray-600 whitespace-pre-wrap" x-text="JSON.stringify(formData, null, 2)"></pre>
            </div>
            
            <!-- Validation Errors Preview -->
            <div x-show="Object.keys(errors).length > 0" class="mt-4 p-4 bg-red-50 rounded-lg">
              <h4 class="font-semibold mb-2 text-red-800">Validation Errors:</h4>
              <pre class="text-sm text-red-600 whitespace-pre-wrap" x-text="JSON.stringify(errors, null, 2)"></pre>
            </div>
          </div>
        </form>
      </div>
    </Card>

    <!-- Feature Demonstration -->
    <Card class="mb-8">
      <div class="p-6">
        <h2 class="text-2xl font-bold mb-4">Feature Demonstration</h2>
        <div class="space-y-6">
          <!-- Calendar Navigation -->
          <div>
            <h3 class="text-lg font-semibold mb-3">Calendar Features</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Calendar Navigation</label>
                <DatePicker 
                  name="navigation-demo"
                  placeholder="Test navigation features"
                  format="M j, Y"
                />
                <ul class="text-sm text-gray-600 mt-2 space-y-1">
                  <li>• Click arrows to navigate months</li>
                  <li>• Click "Today" for current date</li>
                  <li>• Today's date is highlighted</li>
                  <li>• Selected date is marked in blue</li>
                </ul>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Keyboard Controls</label>
                <DatePicker 
                  name="keyboard-demo"
                  placeholder="Test keyboard features"
                  format="j F Y"
                />
                <ul class="text-sm text-gray-600 mt-2 space-y-1">
                  <li>• Press Escape to close calendar</li>
                  <li>• Click outside to close calendar</li>
                  <li>• Persistent state with localStorage</li>
                </ul>
              </div>
            </div>
          </div>
          
          <!-- Format Comparison -->
          <div>
            <h3 class="text-lg font-semibold mb-3">Format Comparison</h3>
            <div class="space-y-4" x-data="{ selectedDate: '2024-07-15' }">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Master Date Selector</label>
                  <DatePicker 
                    name="format-master"
                    placeholder="Select a date"
                    format="Y-m-d"
                    x-model="selectedDate"
                  />
                </div>
                
                <div class="flex items-center">
                  <p class="text-sm text-gray-600">Change this date to see all formats update</p>
                </div>
              </div>
              
              <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div>
                  <p class="text-xs font-medium text-gray-500 mb-1">ISO (Y-m-d)</p>
                  <div class="p-2 bg-gray-50 rounded text-sm" x-text="selectedDate || 'No date'"></div>
                </div>
                
                <div>
                  <p class="text-xs font-medium text-gray-500 mb-1">US (M j, Y)</p>
                  <div class="p-2 bg-gray-50 rounded text-sm" x-text="selectedDate ? new Date(selectedDate).toLocaleDateString('en-US', {month: 'short', day: 'numeric', year: 'numeric'}) : 'No date'"></div>
                </div>
                
                <div>
                  <p class="text-xs font-medium text-gray-500 mb-1">Numeric (m/d/Y)</p>
                  <div class="p-2 bg-gray-50 rounded text-sm" x-text="selectedDate ? new Date(selectedDate).toLocaleDateString('en-US') : 'No date'"></div>
                </div>
                
                <div>
                  <p class="text-xs font-medium text-gray-500 mb-1">Full (j F Y)</p>
                  <div class="p-2 bg-gray-50 rounded text-sm" x-text="selectedDate ? new Date(selectedDate).toLocaleDateString('en-GB', {day: 'numeric', month: 'long', year: 'numeric'}) : 'No date'"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </Card>

    <!-- Status Summary -->
    <Card>
      <div class="p-6">
        <h2 class="text-2xl font-bold mb-4">Test Results</h2>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div class="text-center p-4 bg-green-50 rounded-lg">
            <Badge color="green" class="mb-2">✓ Working</Badge>
            <p class="text-sm">Date selection working</p>
          </div>
          <div class="text-center p-4 bg-green-50 rounded-lg">
            <Badge color="green" class="mb-2">✓ Working</Badge>
            <p class="text-sm">Date formats working</p>
          </div>
          <div class="text-center p-4 bg-green-50 rounded-lg">
            <Badge color="green" class="mb-2">✓ Working</Badge>
            <p class="text-sm">Calendar navigation working</p>
          </div>
          <div class="text-center p-4 bg-green-50 rounded-lg">
            <Badge color="green" class="mb-2">✓ Working</Badge>
            <p class="text-sm">Form integration working</p>
          </div>
        </div>
        
        <div class="mt-6 p-4 bg-blue-50 rounded-lg">
          <h3 class="font-semibold text-blue-800 mb-2">DatePicker Features Tested:</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-700">
            <ul class="space-y-1">
              <li>✓ Basic date selection</li>
              <li>✓ Multiple date formats (Y-m-d, M j Y, m/d/Y, j F Y)</li>
              <li>✓ Pre-selected values</li>
              <li>✓ Disabled and read-only states</li>
              <li>✓ Custom styling (input, calendar, container)</li>
            </ul>
            <ul class="space-y-1">
              <li>✓ Interactive form validation</li>
              <li>✓ Date range validation</li>
              <li>✓ Calendar navigation</li>
              <li>✓ Today button functionality</li>
              <li>✓ Keyboard controls (Escape)</li>
              <li>✓ Click outside to close</li>
              <li>✓ Persistent state with localStorage</li>
            </ul>
          </div>
        </div>
      </div>
    </Card>
  </main>
</Layout>